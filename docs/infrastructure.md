# Tale - 인프라 & 배포 설계

> 작성일: 2026-02-09
> 대상: 1,000명 SaaS 웹앱 배포 기준

---

## 목차

1. [전제 조건](#1-전제-조건)
2. [시스템 아키텍처](#2-시스템-아키텍처)
3. [시나리오 A: 외부 API 모델](#3-시나리오-a-외부-api-모델)
4. [시나리오 B: 자체 모델 + IP 보호](#4-시나리오-b-자체-모델--ip-보호)
5. [비용 비교 요약](#5-비용-비교-요약)
6. [보안 아키텍처](#6-보안-아키텍처)
7. [단계별 도입 로드맵](#7-단계별-도입-로드맵)

---

## 1. 전제 조건

| 항목 | 가정 |
|------|------|
| 등록 사용자 | 1,000명 |
| DAU | ~100명 (10%) |
| 일 영상 생성 | ~50-100건 |
| 월 영상 생성 | ~1,500-3,000건 |
| 영상당 평균 샷 수 | 8개 (8초 × 8 = ~1분) |
| 피크 동시 생성 | ~5-10건 |

---

## 2. 시스템 아키텍처

### 공통 구조 (시나리오 A/B 동일)

```
사용자 (브라우저)
       │
       ▼
┌──────────────┐
│  Cloudflare  │  CDN + WAF + DDoS
└──────┬───────┘
       │
  ┌────┴────────────────────┐
  │                         │
┌─▼───────────┐   ┌────────▼────────┐
│ Next.js     │   │  FastAPI         │
│ (프론트엔드) │   │  (API 서버)      │
│ Vercel      │   │  Cloud Run       │
└─────────────┘   └────────┬────────┘
                           │
              ┌────────────┼────────────┐
              │            │            │
     ┌────────▼───┐  ┌────▼─────┐  ┌──▼──────────┐
     │ Supabase   │  │  Redis   │  │ Cloud       │
     │ DB + Auth  │  │  (큐)    │  │ Storage     │
     │ PostgreSQL │  │          │  │ (영상 저장)  │
     └────────────┘  └────┬─────┘  └─────────────┘
                          │
                   ┌──────▼──────┐
                   │   Workers   │  ◀── 여기서부터 A/B 분기
                   └──────┬──────┘
                          │
              ┌───────────┼───────────┐
              │           │           │
           [LLM]     [영상생성]    [이미지생성]
```

**Workers 이후가 시나리오 A와 B의 차이점.**

---

## 3. 시나리오 A: 외부 API 모델

### 구성

| 역할 | 서비스 | 특징 |
|------|--------|------|
| LLM | Google Gemini API | 씬 분할, 프롬프트 생성 |
| 영상 생성 | Google Veo API | T2V/I2V, 8초 클립 |
| 이미지 생성 | OpenAI DALL-E 3 | 캐릭터 레퍼런스 |

### 장점
- 초기 투자 최소 (GPU 인프라 불필요)
- 최신 모델 바로 사용 가능
- 운영 인력 최소

### 단점
- **사용자 프롬프트/스토리가 외부 API로 전송됨**
- API 제공사의 약관에 따라 학습 데이터로 활용될 가능성
- 영상 생성 단가가 높고, 사용량에 비례하여 비용 증가

### 비용 산정

#### 고정 인프라

| 항목 | 서비스 | 월 비용 |
|------|--------|---------|
| 프론트엔드 | Vercel Pro | $20 |
| API 서버 | Cloud Run | $50~150 |
| 워커 | Cloud Run | $100~300 |
| DB + Auth | Supabase Pro | $25 |
| 작업 큐 | Upstash Redis | $10~30 |
| 스토리지 | GCS | $20~50 |
| CDN + 보안 | Cloudflare Pro | $20 |
| 모니터링 | Sentry + Cloud Monitoring | $30~50 |
| **소계** | | **~$275~625** |

#### 변동 API 비용

| API | 영상 1건당 | 월 2,000건 | 월 5,000건 |
|-----|-----------|-----------|-----------|
| Gemini (LLM) | $0.02~0.20 | $40~400 | $100~1,000 |
| **Veo (영상)** | **$4~24** | **$8,000~48,000** | **$20,000~120,000** |
| DALL-E 3 (이미지) | $0.08~0.16 | $160~320 | $400~800 |

#### 시나리오 A 총비용

| 사용량 | 인프라 | API | **월 합계** |
|--------|--------|-----|------------|
| 500건/월 (베타) | ~$400 | ~$3,000 | **~$3,500** |
| 2,000건/월 | ~$500 | ~$16,000 | **~$17,000** |
| 5,000건/월 | ~$600 | ~$60,000 | **~$61,000** |

---

## 4. 시나리오 B: 자체 모델 + IP 보호

### 핵심 목표

> 사용자의 스토리/아이디어/캐릭터 설정은 **IP(지적 재산)**이다.
> 외부 API로 전송하지 않고, 자체 인프라에서 처리하여
> 제3자 학습 데이터로 유출되지 않도록 보장한다.

### 모델 구성

| 역할 | 외부 API 대체 | 자체 모델 후보 | GPU 요구 |
|------|-------------|--------------|---------|
| LLM | Gemini → | Llama 3.1 70B / Qwen 2.5 72B | A100 80GB × 1 |
| 영상 생성 | Veo → | CogVideoX-5B / Wan2.1 / HunyuanVideo | A100 80GB × 2~4 |
| 이미지 생성 | DALL-E → | SDXL / Flux.1 | A10G × 1 |

### 인프라 구성

```
┌─────────────────────────────────────────────────────┐
│                   Private VPC (GCP)                  │
│                                                      │
│  ┌──────────────┐  ┌──────────────┐                 │
│  │ API Server   │  │ Redis Queue  │                 │
│  │ Cloud Run    │  │              │                 │
│  └──────┬───────┘  └──────┬───────┘                 │
│         │                  │                         │
│         └────────┬─────────┘                         │
│                  │                                   │
│  ┌───────────────▼───────────────────────────┐      │
│  │         GPU Cluster (GKE)                  │      │
│  │                                            │      │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐  │      │
│  │  │ LLM Node │ │ Video    │ │ Image    │  │      │
│  │  │ A100×1   │ │ Gen Node │ │ Gen Node │  │      │
│  │  │ Llama 70B│ │ A100×2~4 │ │ A10G×1   │  │      │
│  │  └──────────┘ │CogVideoX │ │ SDXL     │  │      │
│  │               └──────────┘ └──────────┘  │      │
│  └───────────────────────────────────────────┘      │
│                                                      │
│  ┌──────────────┐  ┌──────────────┐                 │
│  │ Cloud Storage│  │ Supabase     │                 │
│  │ (영상 저장)   │  │ (DB + Auth)  │                 │
│  └──────────────┘  └──────────────┘                 │
│                                                      │
│  ── 외부로 나가는 AI 데이터 없음 ──                    │
└─────────────────────────────────────────────────────┘
```

### IP 보호 보안 절차

#### 데이터 흐름 통제

| 구간 | 보호 조치 |
|------|----------|
| 사용자 → API 서버 | TLS 1.3 암호화 전송 |
| API 서버 → GPU 클러스터 | Private VPC 내부 통신만 허용 (인터넷 차단) |
| GPU → Storage | VPC 내부 + 서비스 계정 인증 |
| Storage → 사용자 | Signed URL (시간 제한 접근) |

#### 모델 운영 보안

| 항목 | 조치 |
|------|------|
| **학습 데이터 격리** | 추론 전용 클러스터와 파인튜닝 클러스터 물리 분리 |
| **모델 가중치 관리** | GCS 암호화 저장 + IAM 접근 제어 |
| **프롬프트 로깅** | 내부 DB에만 저장, 외부 전송 없음 |
| **네트워크 정책** | GPU 노드 → 인터넷 egress 차단 (모델 다운로드 시에만 임시 개방) |
| **감사 로그** | 모든 추론 요청 기록 (누가, 언제, 어떤 프롬프트) |

#### 사용자 IP 보호 등급

| 등급 | 대상 | 보호 수준 |
|------|------|----------|
| Level 1 | 스토리/시나리오 원문 | 암호화 저장 + 접근 로그 + 소유자만 열람 |
| Level 2 | 캐릭터 설정/레퍼런스 | 암호화 저장 + 프로젝트별 격리 |
| Level 3 | 생성된 프롬프트 | 내부 DB 저장, 외부 미전송 |
| Level 4 | 생성된 영상 | Signed URL + 다운로드 워터마크 (선택) |

### 비용 산정

#### GPU 인프라 (GCP 기준, 월 단위)

| 용도 | GPU | 수량 | 시간당 | 월 비용 (24/7) | 월 비용 (12h/일) |
|------|-----|------|--------|---------------|-----------------|
| LLM 추론 | A100 80GB | 1 | $3.67 | $2,640 | $1,320 |
| 영상 생성 | A100 80GB | 2 | $3.67×2 | $5,280 | $2,640 |
| 영상 생성 (피크) | A100 80GB | +2 (auto) | $3.67×2 | ~$1,000 (스팟) | ~$500 |
| 이미지 생성 | A10G | 1 | $1.00 | $720 | $360 |
| **GPU 소계** | | | | **$9,640** | **$4,820** |

> **스팟/선점형 인스턴스** 활용 시 60~70% 절감 가능
> A100 스팟: ~$1.10/h (정가의 30%)

#### GPU 비용 최적화 버전

| 전략 | 구성 | 월 비용 |
|------|------|---------|
| 풀 가동 (24/7, 정가) | A100×3 + A10G×1 | ~$9,640 |
| 업무시간 가동 (12h) | 같은 구성 | ~$4,820 |
| 스팟 인스턴스 활용 | 영상 생성만 스팟 | ~$4,200 |
| **추천: 혼합** | LLM 상시 + 영상 스팟 + 오토스케일 | **~$3,500~5,000** |

#### 추가 인프라

| 항목 | 서비스 | 월 비용 |
|------|--------|---------|
| GKE 클러스터 관리 | GKE Standard | $75 |
| 네트워크 (VPC, NAT) | GCP Networking | $50~100 |
| 모델 스토리지 | GCS (모델 가중치 ~100GB) | $2 |
| Container Registry | Artifact Registry | $10 |
| 시크릿 관리 | Secret Manager | $5 |
| 모니터링 강화 | Cloud Monitoring + Logging | $50~100 |
| **소계** | | **~$200~300** |

#### 시나리오 B 총비용

| 항목 | 월 비용 |
|------|---------|
| 공통 인프라 (프론트, DB, CDN 등) | ~$400 |
| GPU 인프라 (혼합 최적화) | ~$3,500~5,000 |
| 추가 인프라 (VPC, GKE 등) | ~$250 |
| 외부 API 비용 | **$0** |
| **합계** | **~$4,000~5,600/월** |

> 영상 생성량과 무관한 **고정 비용** 구조.
> 월 2,000건이든 5,000건이든 비용 동일.

---

## 5. 비용 비교 요약

### 월 사용량별 비교

| 월 생성량 | 시나리오 A (외부 API) | 시나리오 B (자체 모델) | 유리한 쪽 |
|----------|---------------------|---------------------|----------|
| 500건 (베타) | ~$3,500 | ~$4,500 | **A** (API가 저렴) |
| 1,500건 | ~$12,000 | ~$4,500 | **B** (자체 2.7배 저렴) |
| 3,000건 | ~$25,000 | ~$5,000 | **B** (자체 5배 저렴) |
| 5,000건 | ~$61,000 | ~$5,500 | **B** (자체 11배 저렴) |

### 손익분기점

> **월 ~800건** 이상 생성하면 자체 모델이 비용 효율적.
> 1,000명 SaaS에서 DAU 100명 기준 일 50건만 넘어도 B가 유리.

### 시나리오별 장단점

| 항목 | A: 외부 API | B: 자체 모델 |
|------|------------|-------------|
| 초기 투자 | **낮음** (즉시 시작) | 높음 (GPU 세팅 2-4주) |
| 영상 품질 | **최상** (Veo 최신) | 양호 (오픈소스 모델) |
| 비용 구조 | 종량제 (사용량 비례) | **고정비** (사용량 무관) |
| IP 보호 | 취약 (데이터 외부 전송) | **완전 보호** |
| 운영 난이도 | **쉬움** | 어려움 (MLOps 필요) |
| 확장성 | API 한도 의존 | 자체 제어 |
| 모델 업데이트 | **자동** (API 업그레이드) | 수동 (직접 교체) |

---

## 6. 보안 아키텍처

### 공통 (A/B 모두)

| 영역 | 구현 | 비용 |
|------|------|------|
| 인증 | Supabase Auth (JWT + OAuth) | 포함 |
| DB 보안 | Row Level Security (RLS) | 포함 |
| API 보호 | Rate Limiting (사용자별) | Cloudflare 포함 |
| DDoS | Cloudflare DDoS Protection | Free~Pro |
| WAF | Cloudflare WAF | Pro $20/월 |
| HTTPS | TLS 1.3 강제 | 무료 |
| 데이터 암호화 | AES-256 at rest (GCS/Supabase 기본) | 포함 |

### 시나리오 B 추가 보안

| 영역 | 구현 | 비용 |
|------|------|------|
| 네트워크 격리 | Private VPC + VPC Service Controls | ~$50/월 |
| GPU 노드 격리 | 인터넷 egress 차단 정책 | 포함 |
| 감사 로깅 | Cloud Audit Logs (전 구간) | ~$30/월 |
| 데이터 유출 방지 | DLP API (프롬프트 스캔) | ~$20/월 |
| 접근 제어 | IAM + Workload Identity | 포함 |
| 침입 탐지 | Security Command Center | ~$50/월 (Standard) |
| **추가 보안 소계** | | **~$150/월** |

---

## 7. 단계별 도입 로드맵

### Phase 1: MVP 출시 (시나리오 A)

```
기간: 1~2개월
비용: ~$500/월 + API 종량제
목표: 빠르게 출시, 사용자 반응 확인
```

- 외부 API (Veo + Gemini) 사용
- 크레딧 시스템으로 생성량 제한 (무료 2건/월, 유료 20건/월)
- Supabase Auth + RLS로 기본 보안
- Cloud Run + Vercel 서버리스 구성

### Phase 2: 수익 검증 (시나리오 A 유지)

```
기간: 3~6개월
비용: ~$3,000~10,000/월
목표: PMF 확인, 과금 모델 검증
```

- 유료 플랜 도입 ($15~49/월)
- 사용 패턴 데이터 수집
- 자체 모델 전환 판단 기준 확보:
  - 월 800건 이상 생성 도달 여부
  - IP 보호 요구하는 B2B 고객 유무
  - API 비용이 매출의 60% 이상인지

### Phase 3: 자체 모델 전환 (시나리오 B)

```
기간: 7~12개월
비용: ~$4,500~5,500/월 (고정)
목표: 비용 절감 + IP 보호 + B2B 대응
```

- GPU 클러스터 구축 (GKE + A100)
- 오픈소스 영상 생성 모델 도입
- Private VPC 구성
- B2B 엔터프라이즈 플랜 출시:
  - "귀사의 IP는 외부로 전송되지 않습니다" 보장
  - 감사 로그 제공
  - 전용 테넌트 옵션

### Phase 4: 자체 모델 파인튜닝 (선택)

```
기간: 12개월+
추가 비용: 파인튜닝 클러스터 ~$2,000~3,000/월 (비상시만 가동)
목표: 독자적 영상 품질, 경쟁 우위
```

- 생성된 영상 데이터로 모델 파인튜닝
- 자체 스타일/품질 차별화
- **주의**: 사용자 데이터 활용 시 명시적 동의 필수 (약관 + opt-in)

---

## 부록: 자체 모델 후보 비교 (2026-02 기준)

### 영상 생성

| 모델 | 파라미터 | 해상도 | 길이 | GPU 요구 | 품질 |
|------|---------|--------|------|---------|------|
| CogVideoX-5B | 5B | 720p | 6초 | A100×1 | 양호 |
| Wan2.1 14B | 14B | 720p | 5~10초 | A100×2 | 좋음 |
| HunyuanVideo | 13B | 720p~1080p | 5초 | A100×2~4 | 좋음 |

### LLM

| 모델 | 파라미터 | GPU 요구 | 성능 |
|------|---------|---------|------|
| Llama 3.1 8B | 8B | A10G×1 | 기본 (간단한 프롬프트) |
| Llama 3.1 70B | 70B | A100×1 | 좋음 (씬 분할 가능) |
| Qwen 2.5 72B | 72B | A100×1 | 좋음 (다국어 강점) |

### 이미지 생성

| 모델 | GPU 요구 | 속도 | 품질 |
|------|---------|------|------|
| SDXL | A10G×1 | ~3초/장 | 양호 |
| Flux.1 | A100×1 | ~5초/장 | 좋음 |
